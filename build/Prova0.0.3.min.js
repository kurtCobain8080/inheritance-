/* Prova0.0.3 2015-02-08 */

"use strict";function CanvasImage(a){if("undefined"!=typeof a.img&&"undefined"!==a.img.src){var b={context:document.getElementsByTagName("canvas")[0].getContext("2d"),img:null,sx:0,sy:0,swidth:a.img.naturalWidth,sheight:a.img.naturalHeight,x:0,y:0,z:0,width:0,height:0,name:null,border:null,behaviour:function(){}},c=extend(b,a),d=new canvasElementPrototype(c);d.settings=c,d.draw=function(){c.context.drawImage(c.img,c.sx,c.sy,c.swidth,c.sheight,c.x,c.y,c.width,c.height),c.border&&c.context.strokeRect(c.x,c.y,c.width,c.height)};var e=document.createElement("canvas");return e.width=c.img.naturalWidth,e.height=c.img.naturalHeight,e.getContext("2d").drawImage(c.img,0,0,e.width,e.height),d.imgData=e.getContext("2d").getImageData(0,0,e.width,e.height),d}}function offset(a){var b={top:0,left:0},c=document.documentElement,d=window,e="undefined";return typeof a.getBoundingClientRect!==e&&(b=a.getBoundingClientRect()),{top:b.top+(d.pageYOffset||c.scrollTop)-(c.clientTop||0),left:b.left+(d.pageXOffset||c.scrollLeft)-(c.clientLeft||0)}}function canvasElementPrototype(a){var b=b,c=[];this.on=function(d,e){function f(c){var d=c.pageX-a.context.leftEl,f=c.pageY-a.context.topEl;if(a.context.beginPath(),a.ray==b){a.context.rect(a.x,a.y,a.width,a.height)}else{a.context.arc(a.x,a.y,a.ray,0,2*Math.PI,!1)}a.context.isPointInPath(d,f)&&e(c,d,f)}a.context.canvas.addEventListener(d,f,!1),c.push({event:d,action:f})},this.timeline=window.timeline();this.timeline;this.updates=[];var d=this.updates;a.update!=b&&a.update&&d.push(a.update),d.getElementByLabel=function(a){return this.filter(function(c){return c.label!=b&&c.label==a?c:void 0})},d.remove=function(){return this.splice(index,1),this},this.update=function(a,b){for(var c=0;c<d.length;c++)d[c](a,b)},this.postRender=a.postRender,this.animation=animation,this.destroy=function(){for(var b=0;b<c.length;b++)a.context.canvas.removeEventListener(c[b].event,c[b].action,!1)}}function CanvasElement(a){var b={context:document.getElementsByTagName("canvas")[0].getContext("2d"),x:0,y:0,z:0,width:0,height:0,name:null,border:null,"border-color":"#000","background-color":null,"background-image":null,"background-repeat":null,opacity:null,behaviour:function(){}},c=extend(b,a),d=new canvasElementPrototype(c);if(d.settings=c,c.border)var e=c.border.split(" ");return d.draw=function(){var a=c.context,b=c["background-repeat"]?c["background-repeat"]:"repeat",d=c["background-image"]?a.createPattern(c["background-image"],b):null;if(c.border){var f=a.lineWidth;a.lineWidth=e[0],a.strokeStyle=e[1],a.strokeRect(c.x,c.y,c.width,c.height),a.lineWidth=f}a.beginPath(),a.rect(c.x,c.y,c.width,c.height),c.opacity&&(a.globalAlpha=c.opacity),a.fillStyle=c["background-color"],a.fillStyle&&a.fill(),a.fillStyle=d,a.fillStyle&&(a.save(),a.translate(c.x,c.y),a.fill(),a.restore()),a.globalAlpha=1},d}function setCanvas(a){var b={el:document.getElementsByTagName("canvas")[0],width:null,height:null,update:function(){},postRender:function(){}},c=extend(b,a),d=c.el.getContext("2d");d.updates=[c.update],d.update=function(a,b){for(var c=0;c<d.updates.length;c++)d.updates[c](a,b)},d.settings=c;var e=offset(c.el);d.topEl=e.top,d.leftEl=e.left,d.canvas.width=c.width||d.canvas.width,d.canvas.height=c.height||d.canvas.height,d.elements=[],d.elements.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},d.elements.remove=function(a){this.splice(a,1);for(var b=a;b<this.length;b++)d.elements[b].settings.index=d.elements.indexOf(d.elements[b])},d.root={push:function(a){a.settings.name=a.settings.name||"layer"+d.root.length();var b=d.root[a.settings.name]=a;return b.settings.index=d.elements.length,d.elements.push(b),d.root[a.settings.name]},length:function(){return Object.keys(d.root).length-3},remove:function(a){return"undefined"==typeof d.root[a]?!1:(d.root[a].destroy(),d.elements.remove(d.root[a].settings.index),void delete d.root[a])}};var f=!1;return d.frames=requestFrame(function(a,b){if(!f){d.update(a,b),d.clearRect(0,0,d.canvas.width,d.canvas.height);for(var c in d.root)"undefined"!=typeof d.root[c].draw&&("undefined"!=typeof d.root[c].update&&d.root[c].update(a,b,d.root[c]),d.root[c].draw(),"undefined"!=typeof d.root[c].postRender&&d.root[c].postRender(a,b,d.root[c]));d.settings.postRender(a,b)}}),d.frames.label=c.el.id,d.stop=function(){f=!0},d.play=function(){f=!1},d.getElement=function(a){return d.root[a]},d}function createSprite(a){var b=1e3,c=new function(){};return c.x=0,c.y=0,c.width=0,c.height=0,c.currentWidth=0,c.currentHeight=0,c.items=0,c.rows=0,c.images=[],c.addSprite=function(d){var e=d.naturalWidth,f=d.naturalHeight;c.rows=c.x+e<b?c.rows:c.rows+c.currentHeight,c.x=c.x+e<b?c.x+c.currentWidth:0,c.y=c.x?c.y:c.currentHeight,c.width=c.width<c.x+e&&c.x+e<b?c.x+e:c.width,c.currentWidth=e,c.currentHeight=f+c.rows>c.currentHeight?f:c.currentHeight,c.height=c.currentHeight+c.rows;var g=a.root.push(CanvasImage({x:c.x,y:c.y,img:d,width:e,height:f,border:!0}));return c.images.push(g),c.items++,g},c.clear=function(){for(var b=c.images.length-1;b>-1;b--)a.root.remove(c.images[b].settings.name);c.x=0,c.y=0,c.width=0,c.height=0,c.currentWidth=0,c.currentHeight=0,c.items=0,c.rows=0,c.images=[]},c}var extend=function(a,b){var c,d={};for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(d[c]=a[c]);for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c]);return d},requestFrame=function(a){var b=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(a){var b=Date.now();window.setTimeout(function(){a(b)},1e3/30)},c=window.cancelAnimationFrame||window.mozCancelAnimationFrame,d=function(){var d,e=0,f=!1;this.label="";var g=function(c){if(!f){d=b(g);var h=c-e;e=c,a(c,h)}};this.stop=function(){f=!0,c(d)},this.play=function(){f&&(f=!1,d=b(g))},d=b(g)};return new d},uploadFile=function(a){var b=a.el||document.getElementsByTagName("input")[0],c=a.change||function(){},d=a.callback||function(){},e=function(){var a=function(a,b){var c=new FileReader;a.type.indexOf("text")>=0?(c.onload=function(a){b(a.target.result)},c.readAsText(a)):a.type.indexOf("image")>=0&&(c.onload=function(a){var c=new Image;c.onload=function(){b(c)},c.src=a.target.result},c.readAsDataURL(a))};b.addEventListener("change",function(b){c();for(var e=b.target.files,f=0;f<e.length;f++)a(e[f],function(a){d(a)})})}();return e},spriteSelection=function(a,b){function c(a){if("undefined"!=typeof a)for(var c=0;c<b.length;c++){var d=b[c].id.replace("el","").toLowerCase();b[c].value=a.settings[d]}else for(var c=0;c<b.length;c++)b[c].value="no selection"}return{elements:[],add:function(b){var d=this.elements;d.indexOf(b.settings.name)<0&&(this.elements.push(b.settings.name),b.postRender=function(){a.globalAlpha=.3,a.fillRect(b.settings.x,b.settings.y,b.settings.width,b.settings.height),a.globalAlpha=1},c(b))},remove:function(b){var d=this.elements.indexOf(b.settings.name);this.elements.splice(d,1),b.postRender=void 0;var e=this.elements[this.elements.length-1];c(a.root[e])},clear:function(){for(var b=0;b<this.elements.length;b++)a.root[this.elements[b]].postRender=void 0;this.elements=[]}}};
//# sourceMappingURL=Prova0.0.3.map