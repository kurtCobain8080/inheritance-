/* Prova0.0.2 2015-01-04 */
"use strict";function offset(a){var b={top:0,left:0},c=document.documentElement,d=window,e="undefined";return typeof a.getBoundingClientRect!==e&&(b=a.getBoundingClientRect()),{top:b.top+(d.pageYOffset||c.scrollTop)-(c.clientTop||0),left:b.left+(d.pageXOffset||c.scrollLeft)-(c.clientLeft||0)}}function canvasElementPrototype(a){var b=b,c=[];this.on=function(d,e){function f(c){var d=c.pageX-a.context.leftEl,f=c.pageY-a.context.topEl;if(a.context.beginPath(),a.ray==b){a.context.rect(a.x,a.y,a.width,a.height)}else{a.context.arc(a.x,a.y,a.ray,0,2*Math.PI,!1)}a.context.isPointInPath(d,f)&&e(c,d,f)}a.context.canvas.addEventListener(d,f,!1),c.push({event:d,action:f})},this.update=a.update,this.postRender=a.postRender,this.destroy=function(){for(var b=0;b<c.length;b++)a.context.canvas.removeEventListener(c[b].event,c[b].action,!1)}}function CanvasElement(a){var b={context:document.getElementsByTagName("canvas")[0].getContext("2d"),x:0,y:0,z:0,width:0,height:0,name:null,border:null,"border-color":"#000","background-color":null,"background-image":null,"background-repeat":null,opacity:null,behaviour:function(){}},c=extend(b,a),d=new canvasElementPrototype(c);return d.settings=c,d.draw=function(){var a=c.context,b=c["background-repeat"]?c["background-repeat"]:"repeat",d=c["background-image"]?a.createPattern(c["background-image"],b):null;c.border&&(a.beginPath(),a.lineWidth=c.border,a.strokeStyle=c["border-color"],a.rect(c.x-c.border,c.y-c.border,c.width+c.border,c.height+c.border),a.stroke()),a.beginPath(),a.rect(c.x,c.y,c.width,c.height),c.opacity&&(a.globalAlpha=c.opacity),a.fillStyle=c["background-color"],a.fillStyle&&a.fill(),a.fillStyle=d,a.fillStyle&&(a.save(),a.translate(c.x,c.y),a.fill(),a.restore()),a.globalAlpha=1},d}function bezierCurve(a){var b={context:document.getElementsByTagName("canvas")[0].getContext("2d"),x1:0,y1:0,cp1x:0,cp1y:0,cp2x:0,cp2y:0,x2:0,y2:0,lineWidth:.5,name:null},c=extend(b,a),d=new canvasElementPrototype(c);d.settings=c;var e=(Math.abs(c.width-c.cp1y),Math.abs(c.width-c.cp2y),d.point1=c.context.root.push(Rectangle({context:c.context,x:c.x1-2,y:c.y1-2,width:4,height:4,border:"transparent",background:"#000"})),d.point2=c.context.root.push(Rectangle({context:c.context,x:c.x2-2,y:c.y2-2,width:4,height:4,border:"transparent",background:"#000"})),d.cPoint1=c.context.root.push(Circle({context:c.context,x:c.cp1x,y:c.cp1y,ray:4,background:"#000",update:function(){e.settings.x=c.cp1x,e.settings.y=Math.abs(c.width-c.cp1y)},name:"cPoint1"}))),f=d.cJoint1=c.context.root.push(Line({context:c.context,x:c.x1,y:c.y1,x1:c.cp1x,y1:c.cp1y,update:function(){f.settings.x1=c.cp1x,f.settings.y1=Math.abs(c.width-c.cp1y)},name:"cJoint1"})),g=d.cPoint2=c.context.root.push(Circle({context:c.context,x:c.cp2x,y:c.cp2y,z:0,ray:4,border:"transparent",background:"#000",update:function(){g.settings.x=c.cp2x,g.settings.y=Math.abs(c.width-c.cp2y)},name:"cPoint2"})),h=d.cJoint2=c.context.root.push(Line({context:c.context,x:c.x2,y:c.y2,x1:c.cp2x,y1:Math.abs(c.width-c.cp2y),update:function(){h.settings.x1=c.cp2x,h.settings.y1=Math.abs(c.width-c.cp2y)},name:"cJoint2"})),i=!1,j=!1,k=!1,l=!1;return e.on("mousedown",function(){i=!0}),d.settings.context.canvas.addEventListener("mousemove",function(a){if(i){var b=a.pageX-c.context.leftEl,d=a.pageY-c.context.topEl;c.cp1x=b,c.cp1y=Math.abs(c.width-d)}}),e.on("mouseup",function(){i=!1,k=!0}),g.on("mousedown",function(){j=!0}),d.settings.context.canvas.addEventListener("mousemove",function(a){if(j){var b=a.pageX-c.context.leftEl,d=a.pageY-c.context.topEl;c.cp2x=b,c.cp2y=Math.abs(c.width-d)}}),d.settings.context.canvas.addEventListener("click",function(){c.cp2x==c.cp1x&&k&&c.cp2y==c.cp1y&&l&&(c.cp1x-=18),k=!1,l=!1}),g.on("mouseup",function(){j=!1,l=!0}),d.settings.x=d.settings.x1,d.settings.y=d.settings.y1,d.settings.width=d.settings.x2-d.settings.x1,d.settings.height=d.settings.x2-d.settings.x1,d.draw=function(){var a=c.context;a.beginPath(),a.lineWidth=c.lineWidth,a.moveTo(c.x1,c.y1),a.bezierCurveTo(c.cp1x,Math.abs(c.width-c.cp1y),c.cp2x,Math.abs(c.width-c.cp2y),c.x2,c.y2),a.stroke()},d}function setCanvas(a){var b={el:document.getElementsByTagName("canvas")[0],width:null,height:null,update:function(){},postRender:function(){}},c=extend(b,a),d=c.el.getContext("2d");d.settings=c;var e=offset(c.el);return d.topEl=e.top,d.leftEl=e.left,d.canvas.width=c.width||d.canvas.width,d.canvas.height=c.height||d.canvas.height,d.elements=[],d.elements.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},d.elements.remove=function(a){this.splice(a,1);for(var b=a;b<this.length;b++)d.elements[b].settings.index=d.elements.indexOf(d.elements[b])},d.root={push:function(a){a.settings.name=a.settings.name||"layer"+d.root.length();var b=d.root[a.settings.name]=a;return b.settings.index=d.elements.length,d.elements.push(b),d.root[a.settings.name]},length:function(){return Object.keys(d.root).length-3},remove:function(a){return"undefined"==typeof d.root[a]?!1:(d.root[a].destroy(),d.elements.remove(d.root[a].settings.index),void delete d.root[a])}},d.frames=requestFrame(function(a){d.settings.update(a),d.clearRect(0,0,d.canvas.width,d.canvas.height);for(var b in d.root)"undefined"!=typeof d.root[b].draw&&("undefined"!=typeof d.root[b].update&&d.root[b].update(),d.root[b].draw(),"undefined"!=typeof d.root[b].postRender&&d.root[b].postRender());d.settings.postRender(a)}),d.getElement=function(a){return d.root[a]},d}var extend=function(a,b){var c,d={};for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(d[c]=a[c]);for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c]);return d},Bezier=function(){var a=400,b=function(a){return 1/(200*a)},c=function(c,d,e,f){var g=3*c,h=3*(e-c)-g,i=1-g-h,j=3*d,k=3*(f-d)-j,l=1-j-k,m=function(a){return((i*a+h)*a+g)*a},n=function(a){return((l*a+k)*a+j)*a},o=function(a){return(3*i*a+2*h)*a+g},p=function(a,b){var c,d,e,f,g,h;for(e=a,h=0;8>h;h++){if(f=m(e)-a,Math.abs(f)<b)return e;if(g=o(e),Math.abs(g)<1e-6)break;e-=f/g}if(c=0,d=1,e=a,c>e)return c;if(e>d)return d;for(;d>c;){if(f=m(e),Math.abs(f-a)<b)return e;a>f?c=e:d=e,e=.5*(d-c)+c}return e},q=function(a,b){return n(p(a,b))};return function(c,d){return q(c,b(+d||a))}};return{linear:c(0,0,1,1),ease:c(.25,.1,.25,1),easeIn:c(.42,0,1,1),easeOut:c(0,0,.58,1),easeInOut:c(.42,0,.58,1),cubicBezier:function(a,b,d,e,f,g){return c(a,b,d,e)(f,g)}}}();window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(a){var b=Date.now();window.setTimeout(function(){a(b)},1e3/30)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame;var requestFrame=function(a){var b=function(){var b=0,c=!1,d=function(e){if(!c){requestAnimationFrame(d);var f=e-b;b=e,a(f)}};this.stop=function(){c=!0,cancelAnimationFrame(d)},this.play=function(){c&&(c=!1,requestAnimationFrame(d))},requestAnimationFrame(d)};return new b},Circle=function(a){var b={context:document.getElementsByTagName("canvas")[0].getContext("2d"),x:0,y:0,z:0,ray:0,border:"#000",background:"#000",name:null},c=extend(b,a),d=new canvasElementPrototype(c);return d.settings=c,d.draw=function(){c.context.beginPath(),c.context.fillStyle=c.background,c.context.arc(c.x,c.y,c.ray,0,2*Math.PI,!1),c.context.fill()},d},Line=function(a){var b={context:document.getElementsByTagName("canvas")[0].getContext("2d"),x:0,y:0,z:0,x1:0,y1:0,color:"#000",name:null},c=extend(b,a),d=new canvasElementPrototype(c);return d.settings=c,d.draw=function(){c.context.beginPath(),c.context.lineWidth=.5,c.context.strokeStyle=c.color,c.context.moveTo(c.x,c.y),c.context.lineTo(c.x1,c.y1),c.context.stroke()},d},Rectangle=function(a){var b={context:document.getElementsByTagName("canvas")[0].getContext("2d"),x:0,y:0,z:0,width:0,height:0,border:"#000",background:"#000",name:null},c=extend(b,a),d=new canvasElementPrototype(c);return d.settings=c,d.draw=function(){c.context.beginPath(),"transparent"!=c.border&&(c.context.beginPath(),c.context.strokeStyle=c.border,c.context.strokeRect(c.x-1,c.y-1,c.width+1,c.height+1)),"transparent"!=c.background&&(c.context.beginPath(),c.context.fillStyle=c.background,c.context.fillRect(c.x,c.y,c.width,c.height))},d};